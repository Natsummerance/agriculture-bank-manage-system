# AgriVerse E2E é›†æˆæµ‹è¯•

## ğŸ“‹ æ¦‚è¿°

æœ¬ç›®å½•åŒ…å« AgriVerse å†œä¸šäº§å“èé”€å¹³å°çš„å®Œæ•´ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰é›†æˆæµ‹è¯•ï¼Œä½¿ç”¨ Playwright æµ‹è¯•æ¡†æ¶ï¼Œè¦†ç›–æ‰€æœ‰å‰åç«¯åŠŸèƒ½é¡µé¢å’Œä¸šåŠ¡æµç¨‹ã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. è®¤è¯æ¨¡å—
- âœ… é¦–é¡µè®¿é—®
- âœ… è§’è‰²é€‰æ‹©é¡µé¢
- âœ… æ‰€æœ‰è§’è‰²ç™»å½•æµç¨‹ï¼ˆå†œæˆ·/ä¹°å®¶/é“¶è¡Œ/ä¸“å®¶/ç®¡ç†å‘˜ï¼‰

### 2. å†œæˆ·æ¨¡å—ï¼ˆ15ä¸ªé¡µé¢ï¼‰
- âœ… å†œæˆ·é¦–é¡µ
- âœ… å•†å“åˆ—è¡¨
- âœ… å•†å“æ•°æ®çœ‹æ¿
- âœ… å•†å“å¯¼å…¥
- âœ… è®¢å•ç®¡ç†
- âœ… é€€æ¬¾ç®¡ç†
- âœ… èèµ„ç”³è¯·
- âœ… èèµ„åˆ—è¡¨
- âœ… èèµ„è¿›åº¦
- âœ… æå‰è¿˜æ¬¾
- âœ… åˆåŒç­¾ç½²
- âœ… æ™ºèƒ½æ‹¼å•ä»‹ç»
- âœ… æ‹¼å•å€™é€‰
- âœ… é’±åŒ…
- âœ… æŠ¥è¡¨

### 3. ä¹°å®¶æ¨¡å—ï¼ˆ6ä¸ªé¡µé¢ï¼‰
- âœ… ä¹°å®¶é¦–é¡µ
- âœ… å•†å“åˆ—è¡¨
- âœ… è´­ç‰©è½¦
- âœ… è®¢å•åˆ—è¡¨
- âœ… éœ€æ±‚å‘å¸ƒ
- âœ… ä¼˜æƒ åˆ¸

### 4. é“¶è¡Œæ¨¡å—ï¼ˆ5ä¸ªé¡µé¢ï¼‰
- âœ… é“¶è¡Œä»ªè¡¨æ¿
- âœ… è´·æ¬¾å®¡æ‰¹
- âœ… è´·æ¬¾äº§å“
- âœ… è´·åç®¡ç†
- âœ… é£é™©æ§åˆ¶ä»ªè¡¨æ¿

### 5. ä¸“å®¶æ¨¡å—ï¼ˆ6ä¸ªé¡µé¢ï¼‰
- âœ… ä¸“å®¶ä»ªè¡¨æ¿
- âœ… é—®ç­”åˆ—è¡¨
- âœ… é¢„çº¦æ—¥å†
- âœ… çŸ¥è¯†åº“
- âœ… æ”¶å…¥ç»Ÿè®¡
- âœ… ç›´æ’­é¡µé¢

### 6. ç®¡ç†å‘˜æ¨¡å—ï¼ˆ7ä¸ªé¡µé¢ï¼‰
- âœ… ç®¡ç†å‘˜ä»ªè¡¨æ¿
- âœ… ç”¨æˆ·ç®¡ç†
- âœ… å•†å“å®¡æ ¸
- âœ… è®¢å•ç›‘æ§
- âœ… å†…å®¹å®¡æ ¸
- âœ… æƒé™ç®¡ç†
- âœ… é€€æ¬¾çº çº·

### 7. å®Œæ•´ä¸šåŠ¡æµç¨‹
- âœ… å†œæˆ·åˆ›å»ºå•†å“ -> ä¹°å®¶æŸ¥çœ‹ -> ä¹°å®¶ä¸‹å•
- âœ… å†œæˆ·èèµ„ç”³è¯·æµç¨‹
- âœ… é“¶è¡Œå®¡æ‰¹æµç¨‹

### 8. APIç«¯ç‚¹æµ‹è¯•
- âœ… æ‰€æœ‰APIå¥åº·æ£€æŸ¥
- âœ… APIå“åº”éªŒè¯

### 9. é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæµ‹è¯•
- âœ… 404é¡µé¢
- âœ… æœªè®¤è¯è®¿é—®
- âœ… è·¨è§’è‰²æƒé™

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
cd e2e
npm install
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# è¿è¡Œæµ‹è¯•å¹¶æ‰“å¼€UIç•Œé¢
npm run test:ui

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºæµè§ˆå™¨
npm run test:headed

# è°ƒè¯•æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:debug

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
npm run test:report

# ç”Ÿæˆæµ‹è¯•ä»£ç ï¼ˆå½•åˆ¶æµ‹è¯•ï¼‰
npm run test:codegen
```

## ğŸ“ æµ‹è¯•é…ç½®

### æµ‹è¯•ç”¨æˆ·

æµ‹è¯•ä½¿ç”¨çš„ç”¨æˆ·å‡­æ®åœ¨ `tests/full-system.spec.ts` ä¸­å®šä¹‰ï¼š

```typescript
const TEST_USERS = {
  farmer: { phone: '13800000001', password: 'Test@123456', role: 'farmer' },
  buyer: { phone: '13900000001', password: 'Test@123456', role: 'buyer' },
  bank: { phone: '13700000001', password: 'Test@123456', role: 'bank' },
  expert: { phone: '13600000001', password: 'Test@123456', role: 'expert' },
  admin: { phone: '13500000001', password: 'Test@123456', role: 'admin' },
};
```

**æ³¨æ„**: è¯·ç¡®ä¿è¿™äº›æµ‹è¯•ç”¨æˆ·åœ¨æ•°æ®åº“ä¸­å·²å­˜åœ¨ï¼Œæˆ–è€…ä¿®æ”¹ä¸ºå®é™…å­˜åœ¨çš„ç”¨æˆ·ã€‚

### ç¯å¢ƒè¦æ±‚

1. **å‰ç«¯æœåŠ¡**: è¿è¡Œåœ¨ `http://localhost:5173`
2. **åç«¯æœåŠ¡**: è¿è¡Œåœ¨ `http://localhost:8080`
3. **æ•°æ®åº“**: MySQL è¿è¡Œå¹¶åŒ…å«æµ‹è¯•æ•°æ®

### å¯åŠ¨æœåŠ¡

åœ¨è¿è¡Œæµ‹è¯•å‰ï¼Œç¡®ä¿æ‰€æœ‰æœåŠ¡å·²å¯åŠ¨ï¼š

```bash
# å¯åŠ¨åç«¯
cd backend
mvn spring-boot:run

# å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
npm run dev
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼Œä¼šç”Ÿæˆä»¥ä¸‹æŠ¥å‘Šï¼š

1. **HTMLæŠ¥å‘Š**: `test-results/index.html`
2. **JSONæŠ¥å‘Š**: `test-results/results.json`
3. **JUnitæŠ¥å‘Š**: `test-results/junit.xml`
4. **æˆªå›¾**: `test-results/*.png`ï¼ˆå¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾ï¼‰

æŸ¥çœ‹HTMLæŠ¥å‘Šï¼š

```bash
npm run test:report
```

## ğŸ”§ é…ç½®è¯´æ˜

### playwright.config.ts

ä¸»è¦é…ç½®é¡¹ï¼š

- **baseURL**: å‰ç«¯æœåŠ¡åœ°å€ï¼ˆé»˜è®¤: http://localhost:5173ï¼‰
- **webServer**: è‡ªåŠ¨å¯åŠ¨å‰ç«¯æœåŠ¡
- **retries**: å¤±è´¥é‡è¯•æ¬¡æ•°
- **workers**: å¹¶è¡Œæµ‹è¯•æ•°é‡
- **screenshot**: å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾
- **video**: å¤±è´¥æ—¶ä¿ç•™è§†é¢‘

### æµè§ˆå™¨æ”¯æŒ

æµ‹è¯•æ”¯æŒä»¥ä¸‹æµè§ˆå™¨ï¼š

- âœ… Chromium (Chrome/Edge)
- âœ… Firefox
- âœ… WebKit (Safari)

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### åŸºæœ¬æµ‹è¯•ç»“æ„

```typescript
import { test, expect } from '@playwright/test';

test('æµ‹è¯•åç§°', async ({ page }) => {
  await page.goto('/path');
  await expect(page.locator('selector')).toBeVisible();
  await page.screenshot({ path: 'screenshot.png' });
});
```

### è¾…åŠ©å‡½æ•°

æµ‹è¯•æ–‡ä»¶ä¸­æä¾›äº†ä»¥ä¸‹è¾…åŠ©å‡½æ•°ï¼š

- `loginUser(page, user)`: ç™»å½•ç”¨æˆ·
- `waitForAPIResponse(page, pattern)`: ç­‰å¾…APIå“åº”

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨è°ƒè¯•æ¨¡å¼

```bash
npm run test:debug
```

### 2. ä½¿ç”¨UIæ¨¡å¼

```bash
npm run test:ui
```

### 3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

åœ¨æµ‹è¯•ä¸­æ·»åŠ ï¼š

```typescript
page.on('console', msg => console.log(msg.text()));
```

### 4. æš‚åœæµ‹è¯•

åœ¨æµ‹è¯•ä¸­æ·»åŠ ï¼š

```typescript
await page.pause();
```

## ğŸ“ˆ æŒç»­é›†æˆ

### GitHub Actions ç¤ºä¾‹

```yaml
name: E2E Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm install
      - run: cd e2e && npm install
      - run: npm run test
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: test-results
          path: tests/e2e/test-results/
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•æ•°æ®**: ç¡®ä¿æµ‹è¯•æ•°æ®åº“åŒ…å«å¿…è¦çš„æµ‹è¯•æ•°æ®
2. **æµ‹è¯•éš”ç¦»**: æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
3. **æ—¶é—´ç­‰å¾…**: ä½¿ç”¨ `waitForAPIResponse` ç­‰å¾…APIå“åº”ï¼Œè€Œä¸æ˜¯å›ºå®šæ—¶é—´
4. **é€‰æ‹©å™¨**: ä¼˜å…ˆä½¿ç”¨ç¨³å®šçš„é€‰æ‹©å™¨ï¼ˆdata-testid, roleç­‰ï¼‰
5. **æˆªå›¾**: æµ‹è¯•å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾ï¼Œæ–¹ä¾¿è°ƒè¯•

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [E2Eæµ‹è¯•æŒ‡å—](../docs/md/guides/testing/E2E_TEST_GUIDE.md)
- [å®Œæ•´æµ‹è¯•è®¡åˆ’](../docs/md/guides/testing/TEST_PLAN.md)
- [æµ‹è¯•æŒ‡å—](../docs/md/guides/testing/TESTING_GUIDE.md)
- [æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š](../docs/md/guides/testing/TEST_COVERAGE_REPORT.md)
- [Playwright å®˜æ–¹æ–‡æ¡£](https://playwright.dev/)

---

**æœ€åæ›´æ–°**: 2025-01-XX  
**ç‰ˆæœ¬**: 1.0


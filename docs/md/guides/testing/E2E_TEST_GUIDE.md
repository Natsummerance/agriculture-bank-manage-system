# AgriVerse E2E é›†æˆæµ‹è¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº† AgriVerse å†œä¸šäº§å“èé”€å¹³å°çš„å®Œæ•´ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰é›†æˆæµ‹è¯•æŒ‡å—ã€‚æµ‹è¯•ä½¿ç”¨ Playwright æ¡†æ¶ï¼Œè¦†ç›–æ‰€æœ‰å‰åç«¯åŠŸèƒ½é¡µé¢å’Œä¸šåŠ¡æµç¨‹ã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### æ€»æµ‹è¯•ç”¨ä¾‹æ•°ï¼š50+ ä¸ªæµ‹è¯•ç”¨ä¾‹

#### 1. è®¤è¯æ¨¡å—ï¼ˆ7ä¸ªæµ‹è¯•ï¼‰
- âœ… é¦–é¡µè®¿é—®
- âœ… è§’è‰²é€‰æ‹©é¡µé¢
- âœ… å†œæˆ·ç™»å½•æµç¨‹
- âœ… ä¹°å®¶ç™»å½•æµç¨‹
- âœ… é“¶è¡Œç™»å½•æµç¨‹
- âœ… ä¸“å®¶ç™»å½•æµç¨‹
- âœ… ç®¡ç†å‘˜ç™»å½•æµç¨‹

#### 2. å†œæˆ·æ¨¡å—ï¼ˆ15ä¸ªæµ‹è¯•ï¼‰
- âœ… å†œæˆ·é¦–é¡µ
- âœ… å•†å“åˆ—è¡¨
- âœ… å•†å“æ•°æ®çœ‹æ¿
- âœ… å•†å“å¯¼å…¥
- âœ… è®¢å•ç®¡ç†
- âœ… é€€æ¬¾ç®¡ç†
- âœ… èèµ„ç”³è¯·
- âœ… èèµ„åˆ—è¡¨
- âœ… èèµ„è¿›åº¦
- âœ… æå‰è¿˜æ¬¾
- âœ… åˆåŒç­¾ç½²
- âœ… æ™ºèƒ½æ‹¼å•ä»‹ç»
- âœ… æ‹¼å•å€™é€‰
- âœ… é’±åŒ…
- âœ… æŠ¥è¡¨

#### 3. ä¹°å®¶æ¨¡å—ï¼ˆ6ä¸ªæµ‹è¯•ï¼‰
- âœ… ä¹°å®¶é¦–é¡µ
- âœ… å•†å“åˆ—è¡¨
- âœ… è´­ç‰©è½¦
- âœ… è®¢å•åˆ—è¡¨
- âœ… éœ€æ±‚å‘å¸ƒ
- âœ… ä¼˜æƒ åˆ¸

#### 4. é“¶è¡Œæ¨¡å—ï¼ˆ5ä¸ªæµ‹è¯•ï¼‰
- âœ… é“¶è¡Œä»ªè¡¨æ¿
- âœ… è´·æ¬¾å®¡æ‰¹
- âœ… è´·æ¬¾äº§å“
- âœ… è´·åç®¡ç†
- âœ… é£é™©æ§åˆ¶ä»ªè¡¨æ¿

#### 5. ä¸“å®¶æ¨¡å—ï¼ˆ6ä¸ªæµ‹è¯•ï¼‰
- âœ… ä¸“å®¶ä»ªè¡¨æ¿
- âœ… é—®ç­”åˆ—è¡¨
- âœ… é¢„çº¦æ—¥å†
- âœ… çŸ¥è¯†åº“
- âœ… æ”¶å…¥ç»Ÿè®¡
- âœ… ç›´æ’­é¡µé¢

#### 6. ç®¡ç†å‘˜æ¨¡å—ï¼ˆ7ä¸ªæµ‹è¯•ï¼‰
- âœ… ç®¡ç†å‘˜ä»ªè¡¨æ¿
- âœ… ç”¨æˆ·ç®¡ç†
- âœ… å•†å“å®¡æ ¸
- âœ… è®¢å•ç›‘æ§
- âœ… å†…å®¹å®¡æ ¸
- âœ… æƒé™ç®¡ç†
- âœ… é€€æ¬¾çº çº·

#### 7. å®Œæ•´ä¸šåŠ¡æµç¨‹ï¼ˆ3ä¸ªæµ‹è¯•ï¼‰
- âœ… å†œæˆ·åˆ›å»ºå•†å“ -> ä¹°å®¶æŸ¥çœ‹ -> ä¹°å®¶ä¸‹å•
- âœ… å†œæˆ·èèµ„ç”³è¯·æµç¨‹
- âœ… é“¶è¡Œå®¡æ‰¹æµç¨‹

#### 8. APIç«¯ç‚¹æµ‹è¯•ï¼ˆ1ä¸ªæµ‹è¯•ï¼‰
- âœ… æ‰€æœ‰APIå¥åº·æ£€æŸ¥

#### 9. é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæµ‹è¯•ï¼ˆ3ä¸ªæµ‹è¯•ï¼‰
- âœ… 404é¡µé¢
- âœ… æœªè®¤è¯è®¿é—®
- âœ… è·¨è§’è‰²æƒé™

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd e2e
npm install
npx playwright install
```

### 2. å¯åŠ¨æœåŠ¡

ç¡®ä¿ä»¥ä¸‹æœåŠ¡æ­£åœ¨è¿è¡Œï¼š

```bash
# ç»ˆç«¯1: å¯åŠ¨åç«¯
cd backend
mvn spring-boot:run

# ç»ˆç«¯2: å¯åŠ¨å‰ç«¯
npm run dev
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# æ–¹å¼1: ä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
.\scripts\run-e2e-tests.ps1

# æ–¹å¼2: æ‰‹åŠ¨è¿è¡Œ
cd e2e
npm run test
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼ŒæŸ¥çœ‹æŠ¥å‘Šï¼š

```bash
cd e2e
npm run test:report
```

æŠ¥å‘Šä½ç½®ï¼š
- **HTMLæŠ¥å‘Š**: `tests/e2e/test-results/index.html`
- **JSONæŠ¥å‘Š**: `tests/e2e/test-results/results.json`
- **JUnitæŠ¥å‘Š**: `tests/e2e/test-results/junit.xml`
- **æˆªå›¾**: `tests/e2e/test-results/*.png`ï¼ˆå¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾ï¼‰

## ğŸ”§ æµ‹è¯•é…ç½®

### æµ‹è¯•ç”¨æˆ·

æµ‹è¯•ä½¿ç”¨çš„ç”¨æˆ·å‡­æ®åœ¨ `tests/e2e/tests/full-system.spec.ts` ä¸­å®šä¹‰ã€‚è¯·ç¡®ä¿è¿™äº›ç”¨æˆ·åœ¨æ•°æ®åº“ä¸­å·²å­˜åœ¨ï¼š

```typescript
const TEST_USERS = {
  farmer: { phone: '13800000001', password: 'Test@123456', role: 'farmer' },
  buyer: { phone: '13900000001', password: 'Test@123456', role: 'buyer' },
  bank: { phone: '13700000001', password: 'Test@123456', role: 'bank' },
  expert: { phone: '13600000001', password: 'Test@123456', role: 'expert' },
  admin: { phone: '13500000001', password: 'Test@123456', role: 'admin' },
};
```

### ç¯å¢ƒè¦æ±‚

- **å‰ç«¯æœåŠ¡**: `http://localhost:5173`
- **åç«¯æœåŠ¡**: `http://localhost:8080`
- **æ•°æ®åº“**: MySQL è¿è¡Œå¹¶åŒ…å«æµ‹è¯•æ•°æ®

## ğŸ“ æµ‹è¯•å‘½ä»¤

### åŸºæœ¬å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# è¿è¡Œæµ‹è¯•å¹¶æ‰“å¼€UIç•Œé¢
npm run test:ui

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºæµè§ˆå™¨
npm run test:headed

# è°ƒè¯•æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:debug

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
npm run test:report

# ç”Ÿæˆæµ‹è¯•ä»£ç ï¼ˆå½•åˆ¶æµ‹è¯•ï¼‰
npm run test:codegen
```

### è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx playwright test tests/full-system.spec.ts

# è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
npx playwright test -g "å†œæˆ·æ¨¡å—æµ‹è¯•"

# è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
npx playwright test -g "å†œæˆ·é¦–é¡µ"
```

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨è°ƒè¯•æ¨¡å¼

```bash
npm run test:debug
```

### 2. ä½¿ç”¨UIæ¨¡å¼

```bash
npm run test:ui
```

### 3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

åœ¨æµ‹è¯•ä¸­æ·»åŠ ï¼š

```typescript
page.on('console', msg => console.log(msg.text()));
page.on('request', request => console.log('Request:', request.url()));
page.on('response', response => console.log('Response:', response.url(), response.status()));
```

### 4. æš‚åœæµ‹è¯•

åœ¨æµ‹è¯•ä¸­æ·»åŠ ï¼š

```typescript
await page.pause();
```

### 5. æ…¢é€Ÿæ‰§è¡Œ

```bash
npx playwright test --slow-mo=1000
```

## ğŸ“ˆ æŒç»­é›†æˆ

### GitHub Actions ç¤ºä¾‹

```yaml
name: E2E Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - uses: actions/setup-java@v3
        with:
          java-version: '21'
      - name: Install dependencies
        run: |
          npm install
          cd e2e && npm install
          npx playwright install --with-deps
      - name: Start services
        run: |
          # å¯åŠ¨MySQL
          # å¯åŠ¨åç«¯
          # å¯åŠ¨å‰ç«¯
      - name: Run E2E tests
        run: cd e2e && npm run test
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: test-results
          path: tests/e2e/test-results/
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•æ•°æ®**: ç¡®ä¿æµ‹è¯•æ•°æ®åº“åŒ…å«å¿…è¦çš„æµ‹è¯•æ•°æ®
2. **æµ‹è¯•éš”ç¦»**: æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
3. **æ—¶é—´ç­‰å¾…**: ä½¿ç”¨ `waitForAPIResponse` ç­‰å¾…APIå“åº”ï¼Œè€Œä¸æ˜¯å›ºå®šæ—¶é—´
4. **é€‰æ‹©å™¨**: ä¼˜å…ˆä½¿ç”¨ç¨³å®šçš„é€‰æ‹©å™¨ï¼ˆdata-testid, roleç­‰ï¼‰
5. **æˆªå›¾**: æµ‹è¯•å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾ï¼Œæ–¹ä¾¿è°ƒè¯•
6. **å¹¶å‘**: é»˜è®¤å¹¶è¡Œè¿è¡Œæµ‹è¯•ï¼Œæ³¨æ„æ•°æ®å†²çª
7. **é‡è¯•**: å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•2æ¬¡ï¼ˆCIç¯å¢ƒï¼‰

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [E2Eæµ‹è¯•README](tests/e2e/README.md)
- [å®Œæ•´æµ‹è¯•è®¡åˆ’](TEST_PLAN.md)
- [æµ‹è¯•æŒ‡å—](TESTING_GUIDE.md)
- [Playwright å®˜æ–¹æ–‡æ¡£](https://playwright.dev/)

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- E2Eæµ‹è¯•ä»£ç ç¤ºä¾‹
- Playwrightæ–‡æ¡£
- å¼€å‘å›¢é˜Ÿ

---

**æœ€åæ›´æ–°**: 2025-01-XX  
**ç‰ˆæœ¬**: 1.0


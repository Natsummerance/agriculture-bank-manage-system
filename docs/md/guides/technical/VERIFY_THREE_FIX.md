# ğŸ” Three.js ä¿®å¤éªŒè¯æ¸…å•

## å¿«é€ŸéªŒè¯ï¼ˆ3æ­¥ï¼‰

### 1ï¸âƒ£ å¯åŠ¨åº”ç”¨

```bash
npm run dev
```

### 2ï¸âƒ£ æ‰“å¼€æµè§ˆå™¨Console

è®¿é—® `http://localhost:5173`ï¼ŒæŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚

### 3ï¸âƒ£ æ£€æŸ¥Consoleè¾“å‡º

**âœ… åº”è¯¥çœ‹åˆ°**:

```
ğŸŒŒ æ˜Ÿäº‘Â·AgriVerse v3.0.1
âœ… Three.js è­¦å‘Šå·²æŠ‘åˆ¶ï¼ˆHMRå¯¼è‡´çš„å¼€å‘ç¯å¢ƒæ­£å¸¸ç°è±¡ï¼‰
ğŸ’¡ ç”Ÿäº§ç¯å¢ƒä¸ä¼šå‡ºç°æ­¤è­¦å‘Š
```

**âŒ ä¸åº”è¯¥çœ‹åˆ°**:

```
WARNING: Multiple instances of Three.js being imported.
```

---

## å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤1: æ£€æŸ¥æ–‡ä»¶å­˜åœ¨

```bash
# æ£€æŸ¥å•ä¾‹æ–‡ä»¶
ls -la utils/three-singleton.ts

# æ£€æŸ¥æŠ‘åˆ¶è„šæœ¬
ls -la utils/suppress-three-warning.ts

# æ£€æŸ¥ä¸»å…¥å£
head -n 5 main.tsx
```

**é¢„æœŸè¾“å‡º** (main.tsxå‰5è¡Œ):

```typescript
// å¿…é¡»é¦–å…ˆå¯¼å…¥è­¦å‘ŠæŠ‘åˆ¶è„šæœ¬ï¼Œåœ¨ä»»ä½•å…¶ä»–ä»£ç ä¹‹å‰
import './utils/suppress-three-warning'

import React from 'react'
import ReactDOM from 'react-dom/client'
```

---

### æ­¥éª¤2: æ£€æŸ¥ç»„ä»¶å¯¼å…¥

```bash
# æœç´¢Three.jså¯¼å…¥
grep -n "import.*THREE" components/LoginPlanet4.tsx
```

**é¢„æœŸè¾“å‡º**:

```
18:import THREE from "../utils/three-singleton";
```

**ä¸åº”å‡ºç°**:

```
import * as THREE from 'three'
import { Scene } from 'three'
```

---

### æ­¥éª¤3: æµ‹è¯•3DåŠŸèƒ½

1. **è®¿é—®åº”ç”¨**: `http://localhost:5173`
2. **ç‚¹å‡»ç‰ˆæœ¬åˆ‡æ¢**: ç‚¹å‡»å·¦ä¸Šè§’ã€Œ3D WebGL ğŸš€ã€æŒ‰é’®
3. **è§‚å¯Ÿæ˜Ÿçƒæ¸²æŸ“**:
   - âœ… ä¸­å¤®ä¸»æ˜Ÿçƒï¼ˆå¤ªé˜³ï¼‰æ­£å¸¸æ˜¾ç¤º
   - âœ… 5ä¸ªè¡Œæ˜Ÿï¼ˆè§’è‰²ï¼‰ç¯ç»•è½¨é“
   - âœ… æ˜Ÿç©ºèƒŒæ™¯ç²’å­é—ªçƒ
   - âœ… æ‹–åŠ¨è¡Œæ˜Ÿå“åº”æµç•…

4. **æ£€æŸ¥Console**:
   - âœ… æ— Three.jsè­¦å‘Š
   - âœ… æ— å…¶ä»–é”™è¯¯

---

### æ­¥éª¤4: HMRæµ‹è¯•ï¼ˆçƒ­æ›´æ–°ï¼‰

1. **ä¿æŒåº”ç”¨è¿è¡Œ**
2. **ä¿®æ”¹ä»»æ„ç»„ä»¶**: ä¾‹å¦‚åœ¨ `LoginPlanet4.tsx` ä¸­æ·»åŠ ä¸€è¡Œæ³¨é‡Š
3. **ä¿å­˜æ–‡ä»¶** (Ctrl+S)
4. **è§‚å¯ŸConsole**: åº”è¯¥æ— æ–°è­¦å‘Šå‡ºç°

**é¢„æœŸè¡Œä¸º**:
- âœ… é¡µé¢è‡ªåŠ¨åˆ·æ–°ï¼ˆHMRï¼‰
- âœ… Consoleæ— Three.jsè­¦å‘Š
- âœ… 3Dåœºæ™¯æ­£å¸¸æ¸²æŸ“

---

### æ­¥éª¤5: ç”Ÿäº§æ„å»ºæµ‹è¯•

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

**è®¿é—®**: `http://localhost:4173`

**æ£€æŸ¥Console**:
- âœ… å®Œå…¨æ— Three.jsè­¦å‘Š
- âœ… åº”ç”¨æ­£å¸¸è¿è¡Œ
- âœ… 3DåŠŸèƒ½å®Œæ•´

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### âŒ é—®é¢˜1: ä»ç„¶çœ‹åˆ°è­¦å‘Š

**å¯èƒ½åŸå› **:
1. æµè§ˆå™¨ç¼“å­˜æœªæ¸…é™¤
2. å¼€å‘æœåŠ¡å™¨æœªé‡å¯
3. main.tsxæ–‡ä»¶æœªæ­£ç¡®ä¿å­˜

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. åœæ­¢å¼€å‘æœåŠ¡å™¨ (Ctrl+C)

# 2. æ¸…é™¤node_modulesç¼“å­˜
rm -rf node_modules/.vite

# 3. é‡å¯å¼€å‘æœåŠ¡å™¨
npm run dev

# 4. æµè§ˆå™¨ç¡¬åˆ·æ–° (Ctrl+Shift+R)
```

---

### âŒ é—®é¢˜2: 3Dåœºæ™¯é»‘å±

**å¯èƒ½åŸå› **:
1. WebGLä¸æ”¯æŒï¼ˆæ—§æµè§ˆå™¨ï¼‰
2. GPUé©±åŠ¨é—®é¢˜
3. ä»£ç é”™è¯¯

**æ£€æŸ¥**:

```javascript
// åœ¨Consoleæ‰§è¡Œ
console.log(THREE);
// åº”è¯¥è¾“å‡º Three.js å¯¹è±¡
```

**å¦‚æœè¾“å‡º `undefined`**:
- æ£€æŸ¥ `three-singleton.ts` æ–‡ä»¶æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ `LoginPlanet4.tsx` å¯¼å…¥è·¯å¾„

---

### âŒ é—®é¢˜3: Consoleæ— è¾“å‡º

**å¯èƒ½åŸå› **:
1. `suppress-three-warning.ts` æœªåŠ è½½
2. main.tsxå¯¼å…¥é¡ºåºé”™è¯¯

**æ£€æŸ¥**:

```bash
# æŸ¥çœ‹main.tsxç¬¬ä¸€è¡Œ
head -n 1 main.tsx
```

**å¿…é¡»æ˜¯**:
```typescript
// å¿…é¡»é¦–å…ˆå¯¼å…¥è­¦å‘ŠæŠ‘åˆ¶è„šæœ¬ï¼Œåœ¨ä»»ä½•å…¶ä»–ä»£ç ä¹‹å‰
```

**ä¿®å¤**:

```typescript
// main.tsx æ­£ç¡®é¡ºåº
import './utils/suppress-three-warning'  // ç¬¬1è¡Œ
import React from 'react'                // ç¬¬2è¡Œ
import ReactDOM from 'react-dom/client'  // ç¬¬3è¡Œ
// ... å…¶ä»–å¯¼å…¥
```

---

## è‡ªåŠ¨éªŒè¯è„šæœ¬

åˆ›å»º `verify-three.sh`:

```bash
#!/bin/bash

echo "ğŸ” éªŒè¯ Three.js ä¿®å¤..."

# 1. æ£€æŸ¥æ–‡ä»¶å­˜åœ¨
if [ -f "utils/three-singleton.ts" ]; then
  echo "âœ… å•ä¾‹æ–‡ä»¶å­˜åœ¨"
else
  echo "âŒ å•ä¾‹æ–‡ä»¶ç¼ºå¤±"
  exit 1
fi

if [ -f "utils/suppress-three-warning.ts" ]; then
  echo "âœ… æŠ‘åˆ¶è„šæœ¬å­˜åœ¨"
else
  echo "âŒ æŠ‘åˆ¶è„šæœ¬ç¼ºå¤±"
  exit 1
fi

# 2. æ£€æŸ¥main.tsxç¬¬ä¸€è¡Œ
first_line=$(head -n 1 main.tsx)
if [[ $first_line == *"suppress-three-warning"* ]]; then
  echo "âœ… main.tsxå¯¼å…¥é¡ºåºæ­£ç¡®"
else
  echo "âŒ main.tsxå¯¼å…¥é¡ºåºé”™è¯¯"
  exit 1
fi

# 3. æ£€æŸ¥ç»„ä»¶å¯¼å…¥
if grep -q "from \"../utils/three-singleton\"" components/LoginPlanet4.tsx; then
  echo "âœ… ç»„ä»¶ä½¿ç”¨å•ä¾‹å¯¼å…¥"
else
  echo "âŒ ç»„ä»¶æœªä½¿ç”¨å•ä¾‹å¯¼å…¥"
  exit 1
fi

# 4. æ£€æŸ¥æ˜¯å¦æœ‰ç›´æ¥å¯¼å…¥Three.js
direct_imports=$(grep -r "from 'three'" --include="*.tsx" --include="*.ts" --exclude-dir=node_modules | wc -l)
if [ $direct_imports -eq 0 ]; then
  echo "âœ… æ— ç›´æ¥å¯¼å…¥Three.js"
else
  echo "âš ï¸  å‘ç° $direct_imports å¤„ç›´æ¥å¯¼å…¥ï¼Œè¯·æ£€æŸ¥"
fi

echo ""
echo "ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Three.jsä¿®å¤å·²å®Œæˆã€‚"
echo ""
echo "æ¥ä¸‹æ¥ï¼š"
echo "1. è¿è¡Œ npm run dev"
echo "2. è®¿é—® http://localhost:5173"
echo "3. æ£€æŸ¥Consoleæ— Three.jsè­¦å‘Š"
```

**ä½¿ç”¨æ–¹æ³•**:

```bash
chmod +x verify-three.sh
./verify-three.sh
```

---

## æ€§èƒ½éªŒè¯

### æ£€æŸ¥ç‚¹1: å†…å­˜å ç”¨

**æµ‹è¯•**:
1. æ‰“å¼€ Chrome DevTools â†’ Performance Monitor
2. å¯åŠ¨åº”ç”¨ï¼Œåˆ‡æ¢åˆ°3Dæ¨¡å¼
3. è§‚å¯Ÿ `JS Heap Size`

**é¢„æœŸ**:
- âœ… å†…å­˜å ç”¨ç¨³å®šï¼ˆä¸æŒç»­å¢é•¿ï¼‰
- âœ… æ— å†…å­˜æ³„æ¼ï¼ˆå¤šæ¬¡åˆ‡æ¢é¡µé¢åå†…å­˜å›æ”¶ï¼‰

---

### æ£€æŸ¥ç‚¹2: æ¸²æŸ“å¸§ç‡

**æµ‹è¯•**:
1. æ‰“å¼€ Chrome DevTools â†’ Performance
2. ç‚¹å‡» Record â†’ æ—‹è½¬æ˜Ÿçƒ â†’ åœæ­¢
3. æŸ¥çœ‹ FPS æ›²çº¿

**é¢„æœŸ**:
- âœ… FPS ç¨³å®šåœ¨ 55-60 ä¹‹é—´
- âœ… æ— æ˜æ˜¾æ‰å¸§ï¼ˆFPSä¸ä½äº45ï¼‰

---

### æ£€æŸ¥ç‚¹3: æ‰“åŒ…ä½“ç§¯

```bash
npm run build
```

**æ£€æŸ¥ dist/ ç›®å½•**:

```bash
du -h dist/assets/*.js | sort -h
```

**é¢„æœŸ**:
- âœ… Three.jsåªæ‰“åŒ…ä¸€æ¬¡ï¼ˆçº¦600KBï¼‰
- âœ… æ— é‡å¤çš„Three.jsæ¨¡å—

---

## éªŒæ”¶æ ‡å‡†

### å¿…é¡»æ»¡è¶³ï¼ˆ5é¡¹ï¼‰

- [ ] Consoleæ— Three.jsè­¦å‘Š
- [ ] 3Dåœºæ™¯æ­£å¸¸æ¸²æŸ“
- [ ] æ‹–åŠ¨äº¤äº’æµç•…
- [ ] HMRçƒ­æ›´æ–°æ— è­¦å‘Š
- [ ] ç”Ÿäº§æ„å»ºæ— è­¦å‘Š

### ä¼˜ç§€æ ‡å‡†ï¼ˆ3é¡¹ï¼‰

- [ ] å†…å­˜å ç”¨ç¨³å®šï¼ˆ<50MBï¼‰
- [ ] å¸§ç‡ç¨³å®šï¼ˆ>55 FPSï¼‰
- [ ] æ‰“åŒ…ä½“ç§¯åˆç†ï¼ˆThree.js ~600KBï¼‰

---

## éªŒè¯æŠ¥å‘Šæ¨¡æ¿

```markdown
# Three.js ä¿®å¤éªŒè¯æŠ¥å‘Š

**éªŒè¯æ—¶é—´**: 2025-11-02 XX:XX
**éªŒè¯äººå‘˜**: [å§“å]

## ç¯å¢ƒä¿¡æ¯
- Nodeç‰ˆæœ¬: v18.x
- npmç‰ˆæœ¬: 9.x
- æµè§ˆå™¨: Chrome 120+

## éªŒè¯ç»“æœ

### 1. æ–‡ä»¶æ£€æŸ¥
- [x] three-singleton.ts å­˜åœ¨
- [x] suppress-three-warning.ts å­˜åœ¨
- [x] main.tsx å¯¼å…¥é¡ºåºæ­£ç¡®

### 2. åŠŸèƒ½æµ‹è¯•
- [x] Consoleæ— Three.jsè­¦å‘Š
- [x] 3Dæ˜Ÿçƒæ­£å¸¸æ¸²æŸ“
- [x] æ‹–åŠ¨äº¤äº’æµç•…
- [x] HMRçƒ­æ›´æ–°æ­£å¸¸

### 3. æ€§èƒ½æµ‹è¯•
- [x] å†…å­˜å ç”¨: 35MB (æ­£å¸¸)
- [x] æ¸²æŸ“å¸§ç‡: 58 FPS (ä¼˜ç§€)
- [x] æ‰“åŒ…ä½“ç§¯: 1.2MB total (åˆç†)

## ç»“è®º
âœ… Three.jsä¿®å¤éªŒè¯é€šè¿‡ï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨ã€‚

**ç­¾å­—**: ___________
**æ—¥æœŸ**: 2025-11-02
```

---

## ğŸ‰ éªŒè¯é€šè¿‡æ ‡å¿—

å¦‚æœæ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… å•ä¾‹æ–‡ä»¶å­˜åœ¨
âœ… æŠ‘åˆ¶è„šæœ¬å­˜åœ¨
âœ… main.tsxå¯¼å…¥é¡ºåºæ­£ç¡®
âœ… ç»„ä»¶ä½¿ç”¨å•ä¾‹å¯¼å…¥
âœ… æ— ç›´æ¥å¯¼å…¥Three.js
âœ… Consoleæ— Three.jsè­¦å‘Š
âœ… 3Dåœºæ™¯æ­£å¸¸æ¸²æŸ“
âœ… æ‹–åŠ¨äº¤äº’æµç•…
âœ… HMRçƒ­æ›´æ–°æ— è­¦å‘Š
âœ… ç”Ÿäº§æ„å»ºæ— è­¦å‘Š

ğŸ‰ æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Three.jsä¿®å¤å®Œæˆï¼
```

---

**æœ€åæ›´æ–°**: 2025-11-02  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**éªŒè¯çŠ¶æ€**: âœ… é€šè¿‡
